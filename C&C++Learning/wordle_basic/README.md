# 大作业：Wordle

## 作业简介

[Wordle](https://www.nytimes.com/games/wordle/index.html) 是由 Josh Wardle 开发的网页文字游戏，以其简单有趣的规则在 2021 年底风靡全球，并在 2022 年被纽约时报收购。

Wordle 的玩法是（来自 [Wikipedia](https://zh.wikipedia.org/zh-cn/Wordle)），玩家每日可挑战在六次尝试内，猜出由五个字母所组成的英文单词。所有人每天的单词都一样，来源于作者预先定义的词库（”候选词“），均为比较常见的五字单词。尝试中可以使用的单词（”可用词“）也是预定义的，比候选词的数量更多。

每次尝试后，每个字会显示为绿、黄或灰色：绿色表示字母猜中，而且位置正确；黄色表示单词包含此字母但位置不正确；灰色则表示字母出现的次数多于实际出现的次数。Wordle 还设置有”困难模式“，在此模式下，玩家的猜测必须使用前面已经给出的所有提示，否则为无效猜测。

Wordle 有许多仿制和衍生版，如：

- 更改规则：[Absurdle](https://qntm.org/files/absurdle/absurdle.html)（非确定目标）、[hello wordl](https://hellowordl.net/)（可变词长）
- 中文版：[汉兜](https://handle.antfu.me/)、[成语 Wordle](https://cheeaun.github.io/chengyu-wordle/)（四字词语或成语）、[诗谜](https://peotik.com/)（七言诗句）、[词影](https://cy.surprising.studio/)、[笔兜 Strokle](https://superdexin.github.io/Strokle/)（根据笔画猜测）、[Zidou](https://chaaklau.github.io/zidou/)（粤语拼音）、[注得了](https://words.hk/static/bopomofo-wordle/)（注音符号）
- 其他语言：略
- 非书面语言：[Numberle](https://numberle.org/)、[nerdle](https://nerdlegame.com/)、[math wordle](https://mathwordle.com/)（数学等式）、[passWORDLE](https://rsk0315.github.io/playground/passwordle.html)、[sha256le](https://keftcha.github.io/sha256le/)（直接猜测 SHA256）

除了使用纯粹的人类智慧外，也有许多的工具可以帮助解决 Wordle。此类工具通常分为两类，一类只通过现有的猜测结果来筛选剩余的单词，如 [[1]](https://wordmaker.info/wordle-solver/)、[[2]](https://word.tips/wordle/)、[[3]](https://tryhardguides.com/wordle-solver/)、[[4]](https://www.thewordfinder.com/wordle-solver/)、[[5]](https://wordlesolver.pro/)；还有一类直接给出猜测，并根据反馈指导下一步猜测，如 [[6]](https://jonathanolson.net/wordle-solver/)。著名的科普视频作者 3Blue1Brown 也制作了使用信息熵解决 Wordle 的[视频](https://www.bilibili.com/video/BV1zZ4y1k7Jw)（以及对应的[勘误](https://www.bilibili.com/video/BV1A3411p7Xv)）。

## 作业要求

在本作业中，你需要使用 C++，基于给出的项目模板实现一个本地版本的 Wordle 游戏。

### 自动化测试

作业的基础要求部分将使用测试数据评判给分。你可以在框架根目录下使用此脚本在本地进行测试：

    python ./test.py

### 如何手工测试

当实现了功能，但是测试脚本失败的时候，通常会想手工进行一次测试，来尝试找到问题。

以测例 `02_01_specify_answer` 为例子，我们首先进入仓库的 `cases` 目录下，可以看到这个测例的三个文件：

1. `02_01_specify_answer.in`：程序接收的标准输入
2. `02_01_specify_answer.args`：程序接收的命令行参数
3. `02_01_specify_answer.ans`：程序应该向标准输出打印的内容

那么可以使用以下命令在命令行中手动测试：

```
./main -w build < ./cases/02_01_specify_answer.in > ./cases/02_01_specify_answer.out
```

这里的 `-w build` 是 `02_01_specify_answer.args` 中指定的命令行参数。

然后比对 `02_01_specify_answer.out` 和 `02_01_specify_answer.ans` 的内容，如果一致，并且程序退出返回值符合预期，则评测通过。

### 基础要求（60‘）

此部分功能按点给分，并且必须**按顺序实现**（也就是说，某个功能点得分的必要条件是它与之前的所有功能均正确实现）。除特殊说明外，最终结果以程序在 OJ 中测试的结果为准。

如无特别说明，下面所有涉及到 Wordle 游戏中字母的打印都**必须全部大写**。

- 【task 1】（30分）支持从标准输入指定一个词开始一局游戏（**共 6 次猜测**）。候选词与可用词内嵌在程序中（分别对应代码 `src/builtin_words.h` 中的 `FINAL` 和 `ACCEPTABLE`），从标准输入读取用户的猜测：
    - 在每次猜测（获得可用词列表中的输入）后打印猜测结果和以及所有字母的状态：
        - 程序运行后，不进行任何输出。每次猜测后，如果输入符合要求，则打印一行，形如 `SSSSS AAAAAAAAAAAAAAAAAAAAAAAAAA`  ，前面五个字母是用户的猜测结果，后面 26 个字母是所有字母的状态（类似 Wordle 游戏中的输入键盘）。`S` 和 `A` 允许的取值包括 `R`（Red，数量过多的字母）、`Y`（Yellow，位置不正确的字母）、`G` （Green，正确的字母）、`X`（Unknown，未知状态的字母），语义与作业简介中描述的一致。如答案为 `CRANE`，猜测 `ABUSE` 的结果是 `YRRRG`，猜测 `WANNA` 的结果是 `RYRGR`。如果读入的一行不符合要求，则打印 `INVALID`。在打印所有字母状态时，如果某个字母在猜测中有多个不同的状态，则选择最「好」的一种，即优先级为 `G>Y>R>X`。
    - 在游戏结束（用完六次机会或者猜对）后打印猜测次数（包括猜对的最后一次），如果失败，则还需打印正确答案
        - 打印 `CORRECT n`（其中 `n` 为猜测次数）/ `FAILED ZZZZZ`（其中 `ZZZZZ` 为答案）
        - 游戏结束后正常退出程序
    - 作业框架已经实现了大部分程序逻辑，你需要完成以下任务
        - 所有需要完成的代码段已使用注释`TODO: task1`标明。
        - 补全代码`src/game.h`中函数`cmp_guess_with_answer`的缺失部分，将用户猜测词的状态保存至数组`cs`，将26个字母的状态保存至数组`characters`。
        - 补全代码`src/game.h`中函数`print_result`的缺失部分，按照上文要求的格式进行输出。
- 【task 2】（10分）记现有从标准输入指定答案的模式为**指定答案模式**。在指定答案模式下，增加命令行参数 `-w/--word` 用于指定答案，如 `-w build` 表示指定答案为 `build`；如果不指定，则依旧从标准输入读入答案。增加命令行参数 `-r/--random` 用于启动**随机模式**，在随机模式下，不再采用指定答案模式，而是从候选词库中（项目模版中给定）随机抽取问题。如果没有启动随机模式，则是**指定答案模式**，即从标准输入指定答案，或者使用 `-w/--word` 参数来指定答案。如果没有使用 `-w/--word` 参数指定答案，则每局游戏结束后开始询问是否继续下一局（向标准输出打印一行字符串`Next game?`）。如果是随机模式，则在用户退出前，随机的答案不能与已经玩过的单词重复；如果是指定答案模式（且没有使用 `-w/--word`），每局读入一个新的答案词。
    - 作业框架已经实现了解析命令行参数，并将结果传递给`GameState`类的构造函数。
        - 所有需要完成的代码段已使用注释`TODO: task2`标明。
        - 补全代码`src/state.h`中函数`run`的缺失部分，根据不同模式的不同方法设置本轮游戏的答案。
        - 补全代码`src/words.h`中`WordSet`类的构造函数和`get_random_answer`函数，要求每次生成的单词互不相同。一个可行的思路是，在初始化时随机打乱`answers`，在每次调用`get_random_answer`时从打乱后的数组中顺序取出元素。

- 【task 3】（10分）增加命令行参数 `-D/--difficult` 表示启动**困难模式**。在此模式下，新的猜测中所有位置正确（绿色，即 `G`）的字母不能改变位置，也必须用到所有存在但位置不正确（黄色，即`Y` ）的字母，但是允许在新的猜测中重复使用数量过多（红色，即`R`）的字母，也允许存在但位置不正确（黄色，即`Y` ）的字母再次出现在相同的错误位置。
    - 所有需要完成的代码段已使用注释`TODO: task3`标明。
    - 补全代码`src/game.h`中的`hard_mode_constraints`函数。

- 【task 4】（10分）增加命令行参数 `-t/--stats` 表示在每局后，统计并输出截至目前的游戏成功率（成功局数 / 已玩局数）、平均尝试次数（仅计算成功的游戏，如果没有成功的游戏则为 `0`）。
    - 每局结束后，如果指定 `-t/--stats`则额外进行以下操作：
        - 打印一行 `X Y Z`，分别为成功局数、失败局数（均为整数）和成功游戏的平均尝试次数（浮点数，截断到小数点后两位）；
    - 补全代码`src/state.h`中的`print_game_record`函数。

### 提高要求（20’）

此部分功能没有具体的要求，助教将视完成情况酌情给分。其中有些项目存在依赖关系，无法单独完成。所有项目得到的分数综合不超过 20 分。标记有 “⚠️” 的功能是助教认为复杂度较高的功能，请谨慎上手。

提高要求部分不应该影响已有的自动化测试。你可以编写额外的可执行文件，或者通过额外的编译选项（不同的 `feature`） /命令行参数来区分。

- 设计用户界面（不能替代上面的交互模式）：
    - （10分）基于 TUI 绘制用户界面（需要在 Linux 下正常工作），至少应有输入区、键盘区
    - （20分 ⚠️）基于 GUI 绘制用户界面（可使用任意平台的任意 GUI 框架），效果类似 Wordle 原版体验
- Wordle 求解（此部分均可直接通过标准输入输出交互，不依赖于 UI，候选词列表对于求解器来说是未知的）：
    - （5分）基于现有的猜测结果给出提示，即根据用户提供的所有的已用过的字母和状态（或者游戏的当前状态），从可用词列表（`ACCEPTABLE`）中筛选出所有可能的答案
    - （5分）在这些剩余可用词的基础上，给出若干个推荐词（只需要考虑单步最优，例如按照上述视频中的算法，计算信息熵并排序，也可以自己设计合理的算法）
    - （5分）实现类似 [WORDLESolver](https://jonathanolson.net/wordle-solver/) 的交互解决 Wordle 功能，此时每一步的猜测都可以不局限于剩余可用词，而是考虑全局最优的情况
    - （5分）在实现求解算法的基础上，对整个候选词库测试你算法的平均猜测次数，并给出若干个全局最优（例如猜测次数最少）的起始猜测词
        - 由于可能耗时较长，验收不要求当面运行，给出结果即可
- 其他任何未提及的功能：请先与助教确认可行性，并评估应得分数，如未经确认直接实现则不得分

### 非功能要求（20‘）

- （10分）代码规范
    - 代码风格良好，有合理的注释
- （10分）提交 PDF 格式的大作业报告到网络学堂，包含：
    - 简单的程序结构和说明（不必过长，尤其不要逐句解释代码）
    - 游戏主要功能说明和截图（不必面面俱到）
    - 提高要求的实现方式（如有，尤其是如果使用了自行设计的算法）
    - 完成此作业感想（可选）
- `HONOR-CODE.txt`: 以 TXT 格式记录你参考网上的文章或者代码、与同学的交流情况

## 提示

## 如何编译

本项目使用`Makefile`编译。在本项目的根目录下，使用命令行中输入`make`即可编译。**在下一次编译前，请使用`make clean`命令删除历史结果。**

## 代码规范要求

### 代码风格

**简洁**

    保证代码的简洁：
    
    * 有整齐的缩进，建议用空格缩进而非 tab，两个空格或者四个空格作为一级缩进都可以；
    * 每一行不要有太多字符，例如不超过 80 / 100 个字符；
    * 减少硬编码和魔法数字（magic number），例如代码中多次出现 3.14 的时候，应该定义 `pi = 3.14`，然后后面都用 `pi` 来指代。

**注释**

    在代码中编写适当的注释：
    
    * 在比较复杂的代码块前，描述代码的功能；
    * 过于简单的代码，一般不写注释；
    * 函数要编写注释，包括其功能，参数和输出；
    * 建议用英文，中文也可以，但是注意要用 UTF-8 编码。

**空白**

    代码中应该有适当的空格和空行：
    
    * 函数中，实现不同功能的代码间需要添加空行；
    * 操作符前后应该有空格，例如 `c = a + b`；
    * 保持前后一致的风格。

**命名**

    变量的命名，应该符合一定的规范：
    
    * 尽量用英文单词，而不是中文拼音首字母；
    * 命名与上下文要相关；
    * 不用类似 `a, b, c, d` 这种命名方式。

**工具**

    为了实现上面的部分要求，可以采用一些自动化工具：
    
    * 编辑器自带的格式化功能等

## 注意事项

- Wordle 虽好玩，不要沉迷哦。
- 本作业将严格进行查重，任何抄袭同学或网络已有代码的行为均将被视为学术不端。
- 对于如何判定学术不端，以及应该如何正确地引用已有代码，请阅读 [Writing Code](https://integrity.mit.edu/handbook/writing-code) [Writing Code 中文版](https://jia.je/programming/2022/07/12/writing-code-cn/)
